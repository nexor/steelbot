<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8">
    <link rel="stylesheet" href="style.css" type="text/css" />
    <title>SteelBot - Администрирование</title>
</head>

<body>
 
    
 
    <table align="center" width="70%">
        <tr>
            <td> 
            
            <center class="menu">
        <a href="s2.html">Назад</a> |
        <a href="index.html">Содержание</a> |
        <a href="s4.html">Дальше</a>
    </center>           
   
<div align="justify">
    <h2>Администрирование SteelBot</h2>
    Администрировать SteelBot можно несколькими путями:<br>
    <dl>
        <dt>Редактирование конфигурационного файла config.php</dt>
            <dd>В файле config.php задаются основные настройки функционирования бота</dd>
            <br>        
            
        <dt>Редактирование файла автозапуска команд autorun.php</dt>
            <dd>Файл autorun.php содержит php код, который выполняется всякий раз при успешном подключении
            бота к ICQ серверу. Сюда можно добавить, например, установку статуса бота или таймеры.
            </dd>
            <br>
            
        <dt>Онлайн-администрирование по ICQ через плагин admin</dt>
            <dd>Плагин admin содержит команду eval, с помощью которой можно вводить php код для бота, посылая ему сообщения. Например, можно не останавливая бота менять насйтроки config.php, или инсталлировать новые плагины</dd>
            
    </dl>
</div>

<div align="justify" id="p1">    
    <h2>Настройка конфигурационного файла config.php</h2>
    
    
    <h3>bot_uin</h3>
    <div class="section2">
        UIN, к которому подключается бот.
    </div>
    
    <h3>bot_password</h3>
    <div class="section2">
        Пароль от UINа бота.
    </div>
    
    <h3>master_uin</h3>
    <div class="section2">
        Один или несколько номеров через запятую, с которых доступны команды
        администрирования.
    </div>
    
    <h3>plugin_dir</h3>
    <div class="section2">
        Директория, в которой бот ищет плагины.<br>
        Значение по умолчанию: <tt>dirname(__FILE__).'/plugins'</tt>
    </div>
    
    <h3>delaylisten</h3>
    <div class="section2">
        Интервал прослушки сокета ICQ-соединения в секундах.<br>
        Значение по умолчанию: 1.
    </div>
    
    <h3>connect_attempts</h3>
    <div class="section2">
        Количество попыток, которое совершит бот для подключению к серверу.
        Если все попытки исчерпаны, бот завершает работу.
        <br> Значение по умолчанию: 5
    </div>

    <h3>err_cmd</h3>
    <div class="section2">
        Текст, который будет отослан в случае если пользователь прислал неизвестную команду.
        Значение по умолчанию:
        <tt>Команда не найдена. Для получения помощи наберите help</tt>
    </div>
    
    <h3>msg_charset</h3>
    <div class="section2">
        Кодировка, в которой бот отсылает сообщения пользователям.<br>
        Значение по умолчанию:<tt>windows-1251</tt>
    </div>
    
    <h3>msg_case_sensitive</h3>
    <div class="section2">
        Если опция установлена в true, то команды будут чувствительны<br>
        Значение по умолчанию:<tt>false</tt>
    </div>
    
    <h3>log =&gt; filename_format</h3>
    <div class="section2">
        Маска формата имени файла в логах. Используются те же переменные, что
        и в php функции <a href="http://ru2.php.net/date">date()</a>.
        Имя файла лога будет составлено из номера бота и полученной даты<br>
        Значение по умолчанию:<tt>d_M_Y</tt>
    </div>

    <h3>log =&gt; dateformat</h3>
    <div class="section2">
        Формат записи времени в лог-файле. Переменные, как и в предыдущей 
        опции, такие же как у функции <a href="http://ru2.php.net/date">date()</a>.
        <br>
        Значение по умолчанию:<tt>H:i:s</tt>
    </div>
    
    <h3>log =&gt; msgformat</h3>
    <div class="section2">
        Формат всего сообщения, добавляемого в лог. Используются следующие переменные:
        <dl>
            <dt> <b>%d</b> </dt>
            <dd>дата и время записи, полученные из опции dateformat</dd>
            
            <dt> <b>%u</b> </dt>
            <dd>UIN пользователя, имеющего отношение к данной записи (если таковой
             присутствует, например, при логировании входящего сообщения)</dd>
            
            <dt> <b>%m</b> </dt>
            <dd>Текст сообщения лога</dd>
            
            <dt> <b>%n</b> </dt>
            <dd>Тип сообщения лога. Обычно здесь пишется плагин, который оставляет лог-сообщение</dd>
            
            <dt> <b>%c</b> </dt>
            <dd>Код сообщения. Строка из трех цифр, определяющая тип сообщения.</dd>
        </dl>
        <br>
        Значение по умолчанию:<tt>[%d] %с %n %u %m</tt>
    </div>
    
    <h3>log =&gt; exclude_types</h3>
    <div class="section2">
        Типы сообщений лога, которые исключены из логирования. Более подробно типы
        сообщений можно посмотреть <a href="http://steelbot.net/wiki/doku.php/log:codes">здесь</a><br>
        Значение по умолчанию:<tt>LOG_MSG_SENT</tt>
    </div>
    
    <h3>help.format</h3>
    <div class="section2">
        Формат текста помощи одной команды в случае, если пользователь ввел команду
        help чтобы посмотреть список команд. В этом случае можно показывать ему
        только имена команд, если их много. 
        
        Все такие строки соединяются в одну при вызове команды help, и отсылаются пользователю. Переменные:
        <dl>
            <dt> <b>%c</b> </dt>
            <dd>Имя команды. Иногда эта переменная может быть бесполезна, так как
            в строке помощи к команде сначала указывается эта команда.</dd>
            
            <dt> <b>%s</b> </dt>
            <dd> Строка с текстом помощи. </dd>
        </dl>
        <br>
        Значение по умолчанию:<tt>%s\n</tt>
    </div>

    <h3>help.format_full</h3>
    <div class="section2">
        Формат сообщения помощи в случае, если вызвана справка по одной команде 
        (например через команду help [command]). Переменные такие же как в 
        предыдущей опции<br>
        Значение по умолчанию:<tt>%s</tt>
    </div>
    
    <h3>save_actual_timers</h3>
    <div class="section2">
        Если опция установлена в <tt>true</tt>, то при завершении бота все необработанные таймеры будут записаны в файл и впоследствии загружены при запуске бота. При последующем запуске бота файл с таймерами будет прочитан, и все актуальные на момент запуска бота таймеры восстановлены. <br>
        <small>Примечание: Если процесс бота завершился некорректно, то бот не сможет записать таймеры, и они будут утеряны.</small>
        <br><br>
        Значение по умолчанию:<tt>true</tt>
    </div>
    
    <h3>autoinclude_file</h3>
    <div class="section2">
        Файл, который автоматически подключается при каждом выходе бота в онлайн.
        В этом файле можно, например, устанваливать статус бота.<br>
        Значение по умолчанию:<tt>dirname(__FILE__).&quot;/autorun.php&quot;</tt>
    </div>
    
    <h3>language</h3>
    <div class="section2">
        Язык бота по умолчанию. В настоящий момент (SteelBot 1.4) Поддерживается
        русский (ru), и частично английский(en) языки<br>
        Значение по умолчанию:<tt>ru</tt>
    </div>
    
    <h3>web_password</h3>
    <div class="section2">
        Пароль для защиты от несанкционированного запуска бота через web<br>
        Значение по умолчанию:<tt>steelbot</tt>
    </div>
    
    <h3>db.engine</h3>
    <div class="section2">
        Движок БД, используемый ботом. Доступные движки можно посмотреть в директории /database - это имена находящихся там директорий.<br>
        Значение по умолчанию:<tt>txtdbapi</tt>
    </div>
    
    <h3>lockfile_enabled</h3>
    <div class="section2">
        Эта опция актуальна, если бот запускается через браузер. Если опция 
        установлена в true, то при запуске бота будет создаваться lock-файл, 
        который не позволит запустить бота дважды.<br>
        <small>Примечание: если процесс бота завершается некорректно, то 
        lock-файл не будет удален, что помешает боту запуститься в следующий раз. В таком случае его нужно удалить вручную. Расположен он в директории steelbot/tmp, и имеет вид uin.lock, где uin - номер, под которым запукается бот.</small>
        <br><br>
        Значение по умолчанию:<tt>false</tt>
    </div>   
    
</div>

<div align="justify" id="p2">    
    <h2>Установка плагинов</h2> 
    
    Все плагины должны располагаться в директории steelbot/plugins ( или в той, что указана в опции $cfg['plugin_dir'] ). При запуске бот ищет файлы *.plugin.php в этой директории, а также рекурсивно во всех поддиректориях.
    <br><br>
    Для установки плагина просто поместите файл *.plugin.php в директорию для плагинов (или в поддиректорию, если плагин содержит дополнительные файлы).
    <br>
    При запуске бот загрузит новый плагин и импортирует все команды из него, а также
    проверит зависимости между плагинами, если они есть.
    <br>
    Если плагин импортирует информацию о версии и авторе, то посмотреть ее можно
    с помощью администраторской команды 
    <pre class="code">.plugin info plg</pre>  
    где plg - имя плагина.
    
</div>               


<div align="justify" id="p3">    
    <h2>Интерактивная настройка по ICQ</h2>
    Когда бот уже вышел в онлайн, его можно настраивать, посылая администраторские команды, или через <tt>.eval</tt>. Для получения помощи по администраторским командам пошлите боту сообщение <tt>.help</tt> с администраторского номера.
    
    <h3>Настройка config.php</h3>
    Изменять опции config.php можно так:
    <pre class="code">
.eval set option value</pre>
    Где option - имя опции, value - ее новое значение. value всегда принимается как последовательность символов, поэтому специальные символы или определенный тип переменной установить не удастся. Если требуется ввести специальные символы, это можно сделать напрямую php кодом:
    <pre class="code">
.eval SteelBot::$cfg['option'] = "value\n";</pre> 
    
    <h3>Другие действия</h3>
    Также через .eval можно взаимодействовать с библиотекой протокола, например устанваливать статусы:
    <pre class="code">
.eval Proto::$icq->setStatus('STATUS_ONLINE');</pre> 
<br>
    Посылать сообщения с номера бота:
    <pre class="code">
.eval SteelBot::Msg('hello', 321742);</pre>
    <br>
    Удалять объекты команд без возможности восстановления
    <pre class="code">
.eval unset (SteelBot::$cmdlist['md5']);</pre>
    <br>
    <br>
    ... и многое другое ... ;)
    <br><br>
</div>            

<center class="menu">
        <a href="s2.html">Назад</a> |
        <a href="index.html">Содержание</a> |
        <a href="s4.html">Дальше: ссылки и поддержка</a>
    </center>

</td>
        </tr>
    </table>
</body>

</html>